# ScootChain
ScootChain is a C-based blockchain/cryptography project that implements quantum-safe cryptographic operations using post-quantum digital signatures (Dilithium-2). It provides a command-line interface for key generation, wallet management, and hierarchical key derivation.

Always reference these instructions first and fallback to search or bash commands only when you encounter unexpected information that does not match the info here.

## Working Effectively
- **CRITICAL**: Initialize git submodules first: `git submodule init && git submodule update`
- Build dependencies: `make deps` - NEVER CANCEL. Takes 20+ minutes total. Set timeout to 60+ minutes.
  - `make liboqs` - builds quantum-safe cryptography library. Takes 7+ minutes. NEVER CANCEL.
  - `make rocksdb` - builds database library. Takes 13+ minutes. NEVER CANCEL.
- Build main application: `make` - takes less than 1 second
- Clean build artifacts: `make clean` - removes only main application files, keeps dependencies
- **TIMING EXPECTATIONS**: 
  - liboqs: ~7 minutes - NEVER CANCEL, set timeout to 30+ minutes
  - rocksdb: ~14 minutes - NEVER CANCEL, set timeout to 45+ minutes
  - Total dependency build: ~21 minutes - NEVER CANCEL, set timeout to 60+ minutes
  - Main application: <1 second

## Validation
- **MANDATORY TESTING**: Always test all application commands after making changes:
  - `./scootchain genkey` - generates quantum-safe key pair (public.key, private.key)
  - `./scootchain genwallet` - generates wallet address from public key (wallet.addr)
  - `./scootchain checkwallet` - verifies wallet address matches public key
  - `./scootchain seedgen "test words"` - generates deterministic keys from seed phrase
  - `./scootchain child 1` - derives child key from master private key
- **VALIDATION SCENARIOS**: After any code changes, run complete workflow:
  1. `rm -f *.key *.addr` (clean old files)
  2. `./scootchain genkey` (should create public.key and private.key)
  3. `./scootchain genwallet` (should create wallet.addr)
  4. `./scootchain checkwallet` (should show ✅ match)
  5. `./scootchain seedgen "test phrase"` (should generate deterministic keys)
  6. `./scootchain child 0` (should derive child key)
- Verify all commands exit with code 0 and produce expected output messages
- **NO TESTS**: This repository has no automated test suite - manual validation is required

## Dependencies and Build System
- **Required tools**: gcc, cmake, make
- **External dependencies** (via git submodules):
  - `third_party/liboqs` - Open Quantum Safe cryptography library
  - `third_party/rocksdb` - Facebook RocksDB database (currently unused in build)
- **Build process**:
  1. Git submodules must be initialized: `git submodule init && git submodule update`
  2. Dependencies built with cmake: `make liboqs rocksdb`
  3. Main application uses simple Makefile with gcc
- **Library locations**:
  - liboqs headers: `third_party/liboqs/build/include`
  - liboqs library: `third_party/liboqs/build/lib/liboqs.a`
  - RocksDB headers: `third_party/rocksdb/include` (available but not used)

## Common Tasks
The following information saves time on frequent operations:

### Repository Structure
```
.
├── Makefile              # Main build configuration
├── scootchain.c          # Main application source
├── inc/scootchain.h      # Header file with type definitions
├── db_wrapper.c          # RocksDB wrapper (not currently used)
├── db_wrapper.h          # RocksDB wrapper header
├── third_party/          # Git submodules
│   ├── liboqs/          # Quantum-safe crypto library
│   └── rocksdb/         # Database library
├── public.key           # Generated by genkey command
├── private.key          # Generated by genkey command
└── wallet.addr          # Generated by genwallet command
```

### Key Code Locations
- **Main entry point**: `main()` function in `scootchain.c` (lines 199-220)
- **Command implementations**: 
  - `cmd_genkey()` - random key generation
  - `cmd_genwallet()` - wallet address generation  
  - `cmd_checkwallet()` - wallet verification
  - `cmd_seedgen()` - deterministic key from seed
  - `cmd_child()` - hierarchical key derivation
- **Crypto operations**: Uses Dilithium-2 from liboqs (`OQS_SIG_alg_dilithium_2`)
- **Key storage**: Binary files (public.key, private.key, wallet.addr)

### Build Configuration
- **Compiler**: gcc with `-O2 -Wall` optimization
- **Include paths**: `-Iinc -Ithird_party/liboqs/build/include -Ithird_party/rocksdb/include`
- **Linked libraries**: `third_party/liboqs/build/lib/liboqs.a -lpthread -ldl -lrt -lgcc_s -lc`
- **RocksDB**: Available but commented out in Makefile (`# LDLIBS += third_party/rocksdb/build/librocksdb.a`)

### Application Usage
```bash
./scootchain genkey                    # Generate random quantum-safe key pair
./scootchain genwallet                 # Generate wallet address from public key  
./scootchain checkwallet               # Verify wallet matches public key
./scootchain seedgen "word1 word2..."  # Generate keys from seed phrase
./scootchain child <index>             # Derive child key at index
```

### Build Troubleshooting
- **Submodule issues**: Run `git submodule init && git submodule update`
- **Dependency build failures**: Clean and rebuild: `cd third_party/liboqs && rm -rf build` then `make liboqs`
- **Missing cmake**: Install with `apt-get install cmake`
- **Linker errors**: Ensure liboqs built successfully: `ls -la third_party/liboqs/build/lib/liboqs.a`

## Important Notes
- **NEVER CANCEL BUILDS**: Dependency builds take 20+ minutes total - this is normal
- **No CI/CD**: Repository has no automated testing - manual validation required
- **No RocksDB**: Database wrapper exists but is not used in current build
- **File artifacts**: Commands create binary files (*.key, *.addr) in working directory
- **Quantum-safe**: Uses post-quantum Dilithium-2 digital signatures
- **Deterministic keys**: seedgen and child commands create reproducible keys from input